CREATE OR REPLACE TABLE `topminnow.Pecos_Cyber_Academy.star_growth_summary_subject_grade` AS
SELECT
  school_year_label,
  school_year_start,
  subject,
  grade_level,

  COUNTIF(growth_boy_moy_scaled IS NOT NULL) AS n_boy_moy,
  AVG(growth_boy_moy_scaled) AS avg_growth_boy_moy_scaled,
  STDDEV_SAMP(growth_boy_moy_scaled) AS sd_growth_boy_moy_scaled,
  APPROX_QUANTILES(growth_boy_moy_scaled, 100)[OFFSET(50)] AS median_growth_boy_moy_scaled,

  COUNTIF(growth_boy_eoy_scaled IS NOT NULL) AS n_boy_eoy,
  AVG(growth_boy_eoy_scaled) AS avg_growth_boy_eoy_scaled,
  STDDEV_SAMP(growth_boy_eoy_scaled) AS sd_growth_boy_eoy_scaled,
  APPROX_QUANTILES(growth_boy_eoy_scaled, 100)[OFFSET(50)] AS median_growth_boy_eoy_scaled,

  COUNTIF(growth_moy_eoy_scaled IS NOT NULL) AS n_moy_eoy,
  AVG(growth_moy_eoy_scaled) AS avg_growth_moy_eoy_scaled,
  STDDEV_SAMP(growth_moy_eoy_scaled) AS sd_growth_moy_eoy_scaled,
  APPROX_QUANTILES(growth_moy_eoy_scaled, 100)[OFFSET(50)] AS median_growth_moy_eoy_scaled,

  COUNTIF(growth_boy_moy_pr IS NOT NULL) AS n_boy_moy_pr,
  AVG(growth_boy_moy_pr) AS avg_growth_boy_moy_pr
FROM `topminnow.Pecos_Cyber_Academy.star_growth_student_level`
GROUP BY school_year_label, school_year_start, subject, grade_level;
